# System Cleanup Utility

[View in English](README.md) | [한국어 문서 보기](README.kr.md)

## 개요

이 프로젝트는 macOS 시스템의 유지보수와 최적화를 위한 두 가지 주요 스크립트를 제공합니다:

1. `system_cleanup.sh`: 시스템 정리 및 최적화
2. `system_upgrade.sh`: 시스템 및 앱 업데이트 관리

## 시스템 업그레이드 유틸리티

### 개요

`system_upgrade.sh`는 macOS 시스템의 패키지와 애플리케이션을 최신 상태로 유지하기 위한 자동화된 업그레이드 스크립트입니다. 이 스크립트는 Homebrew, Cask, 그리고 시스템 전체의 업데이트를 관리합니다.

### 주요 기능

- Homebrew 및 Cask 자동 업데이트
- topgrade를 통한 전체 시스템 업데이트
- Homebrew Cask로 설치 가능한 앱 자동 감지 및 설치
- 상세한 로깅 시스템
- 에러 처리 및 복구 메커니즘
- 임시 파일 자동 관리

### 설치

#### 필수 조건

- macOS 운영 체제
- Bash 쉘
- Homebrew 패키지 관리자
- 인터넷 연결

#### 설치 방법

1. GitHub에서 저장소를 클론합니다:

   ```
   git clone https://github.com/your-username/macos-system-cleanup.git
   cd macos-system-cleanup
   ```

2. 스크립트에 실행 권한을 부여합니다:

   ```
   chmod +x src/system_upgrade.sh
   chmod +x src/system_cleanup.sh
   ```

3. (선택 사항) 시스템 전체에서 접근할 수 있도록 심볼릭 링크를 생성합니다:
   ```
   sudo ln -s $(pwd)/src/system_upgrade.sh /usr/local/bin/system_upgrade
   sudo ln -s $(pwd)/src/system_cleanup.sh /usr/local/bin/system_cleanup
   ```

> **참고**: GitHub에서 클론한 경우, 파일 권한이 초기화될 수 있습니다. 반드시 `chmod` 명령어로 실행 권한을 부여해야 합니다.

### 사용 방법

#### 기본 사용법

터미널에서 스크립트를 실행합니다:

```
./system_upgrade.sh
```

또는 심볼릭 링크를 생성한 경우:

```
system_upgrade
```

### 스크립트 섹션 설명

#### 1. 초기 설정

- 임시 디렉토리 생성
- 로깅 시스템 초기화
- 에러 처리 설정

#### 2. Homebrew 업데이트

- Homebrew 패키지 관리자 업데이트
- Homebrew Cask 업데이트
- 업데이트 실패 시 에러 처리

#### 3. topgrade 실행

- topgrade 설치 확인
- 필요한 경우 자동 설치
- 전체 시스템 업데이트 수행

#### 4. 앱 검색 및 설치

- /Applications 디렉토리 스캔
- Homebrew Cask로 설치 가능한 앱 감지
- 버전 정보 확인
- 사용자 확인 후 설치

### 로그 파일

모든 작업은 `/tmp/brew_replace` 디렉토리에 있는 로그 파일에 기록됩니다. 로그 파일에는 다음이 포함됩니다:

- 각 작업에 대한 타임스탬프
- 시스템 명령 출력
- 에러 메시지(있는 경우)
- 설치된 앱 정보

### 문제 해결

#### Homebrew 업데이트 실패

```
ERROR: Failed to update Homebrew
```

**해결책**:

- 인터넷 연결 확인
- Homebrew 수동 업데이트 시도:
  ```
  brew update
  ```

#### topgrade 설치 실패

```
ERROR: Failed to install topgrade
```

**해결책**:

- Homebrew 상태 확인:
  ```
  brew doctor
  ```
- 수동으로 topgrade 설치:
  ```
  brew install topgrade
  ```

#### 권한 오류

```
ERROR: Permission denied
```

**해결책**:

- 스크립트 실행 권한 확인:
  ```
  chmod +x system_upgrade.sh
  ```
- 필요한 디렉토리에 대한 접근 권한 확인

### 보안 고려 사항

- 스크립트는 시스템 수정을 위해 sudo 권한을 사용하지 않습니다
- 모든 설치 작업은 사용자 권한으로 수행됩니다
- 임시 파일은 자동으로 정리됩니다
- 민감한 시스템 파일은 수정하지 않습니다

### 자동화

스크립트를 정기적으로 실행하려면 crontab을 사용할 수 있습니다:

```
# 매주 일요일 자정에 실행
0 0 * * 0 /path/to/system_upgrade.sh
```

## 개요

`system_cleanup.sh`는 macOS 시스템의 디스크 공간을 확보하고 시스템 상태를 유지하기 위해 설계된 자동화된 유지보수 스크립트입니다. 이 스크립트는 패키지 관리자, 캐시, 시스템 로그 등 시스템의 다양한 부분에 대한 일련의 정리 작업을 수행합니다.

## 주요 기능

- 디스크 사용량 분석 및 보고
- Homebrew 패키지 관리 및 정리
- npm 캐시 정리
- 시스템 로그 크기 확인
- Docker 리소스 정리(선택 사항)
- node_modules 디렉토리 분석 및 제안
- Yarn 캐시 정리
- .DS_Store 파일 정리
- 안드로이드 스튜디오 파일 정리
- 모든 작업에 대한 상세한 로깅
- 민감한 작업에 대한 대화형 옵션
- 종합적인 요약 보고서

## 설치

### 필수 조건

- macOS 운영 체제
- Bash 쉘
- Homebrew 패키지 관리자(관련 정리 기능용)
- npm(선택 사항, JavaScript 개발 캐시 정리용)
- Docker(선택 사항, 컨테이너 정리용)
- 안드로이드 스튜디오(선택 사항, 안드로이드 개발 파일 정리용)

### 설치 방법

1. 스크립트를 원하는 위치에 다운로드하세요:

   ```
   curl -o ~/src/system_cleanup.sh https://your-repository-url/system_cleanup.sh
   ```

   또는 텍스트 편집기를 사용하여 파일을 수동으로 생성할 수 있습니다.

2. 스크립트를 실행 가능하게 만드세요:

   ```
   chmod +x ~/src/system_cleanup.sh
   ```

3. (선택 사항) 시스템 전체에서 접근할 수 있도록 심볼릭 링크를 생성하세요:
   ```
   sudo ln -s ~/src/system_cleanup.sh /usr/local/bin/system_cleanup
   ```

## 사용 방법

### 기본 사용법

터미널에서 스크립트를 실행하세요:

```
./system_cleanup.sh
```

또는 심볼릭 링크를 생성한 경우:

```
system_cleanup
```

### 명령행 옵션

스크립트는 다음과 같은 옵션을 지원합니다:

```
  --help          도움말 메시지를 표시합니다
  --auto-clean    프롬프트 없이 모든 정리 작업을 실행합니다
  --dry-run       실제 정리 없이 정리될 내용만 표시합니다
  --no-brew       Homebrew 정리를 건너뜁니다
  --no-npm        npm 캐시 정리를 건너뜁니다
  --no-docker     Docker 정리를 건너뜁니다
  --no-android    안드로이드 스튜디오 정리를 건너뜁니다
```

예제:

```
./system_cleanup.sh --auto-clean --no-docker
```

### 자동화된 실행

스크립트를 일정에 따라 자동으로 실행하려면 `crontab`을 사용합니다:

1. 편집을 위해 crontab을 엽니다:

   ```
   crontab -e
   ```

2. 스크립트를 매주 실행하는 라인을 추가합니다(예: 매주 일요일 자정):

   ```
   0 0 * * 0 /path/to/system_cleanup.sh --auto-clean
   ```

3. 선택적으로 특정 정리 작업을 건너뛰는 옵션을 추가할 수 있습니다:
   ```
   0 0 * * 0 /path/to/system_cleanup.sh --auto-clean --no-android
   ```

## 스크립트 섹션 설명

### 1. 로깅 설정

- 로그 디렉토리(`~/logs`)가 없는 경우 생성합니다
- 각 실행마다 타임스탬프가 있는 로그 파일을 생성합니다
- 오류 처리 및 메시지 로깅 기능을 구현합니다
- 개선된 오류 처리 및 로깅 메시지 시스템을 제공합니다

### 2. 디스크 사용량 확인

- 스크립트 시작 시 현재 디스크 사용량을 보고합니다
- 정리 후 비교를 위한 기준 지표를 제공합니다
- 개선된 디스크 공간 계산 및 표시 로직을 사용합니다
- 다양한 단위(GB, MB, KB, B)를 지원합니다

### 3. 권한 체크 시스템

- 시스템 라이브러리 캐시 정리 권한을 체크합니다
- 시스템 로그 정리 권한을 체크합니다
- 사용자 라이브러리 캐시 정리 권한을 체크합니다
- 임시 파일 정리 권한을 체크합니다
- 권한 부족 시 안전하게 작업을 건너뜁니다

### 4. Homebrew 정리

- Homebrew 패키지 목록을 업데이트합니다
- 오래된 패키지를 식별합니다
- 사용하지 않는 종속성을 확인합니다
- 이전 버전 및 캐시 파일을 정리합니다

### 5. npm 캐시 정리

- npm이 설치되어 있는지 확인합니다
- 정리 전 캐시 크기를 보고합니다
- 검증 단계가 포함된 캐시 정리를 수행합니다
- 정리 후 절약된 공간을 보고합니다
- 오래된 전역 패키지와 사용하지 않는 패키지를 확인합니다
- 패키지 업데이트 및 정리를 위한 대화형 옵션을 제공합니다
- 캐시 정리 성공 여부를 확인하고 권한 문제에 대해 경고합니다

### 6. 시스템 로그 확인

- 시스템 로그 파일 크기를 보고합니다
- 전체 정보를 위해 sudo 액세스가 필요합니다
- 중요한 시스템 로그(system.log, secure.log, auth.log)를 보존합니다
- 권한 요구사항에 대한 명확한 피드백을 제공합니다

### 7. Docker 정리(선택 사항)

- Docker가 설치되어 있는지 확인합니다
- Docker 디스크 사용량을 보고합니다
- 사용하지 않는 Docker 리소스 정리 옵션을 제공합니다
- 부동 이미지, 중지된 컨테이너, 사용하지 않는 네트워크를 포함합니다

### 8. node_modules 디렉토리 정리

- 큰 node_modules 디렉토리를 찾고 보고합니다
- 오래된 프로젝트를 식별하고 수동 정리를 제안합니다

### 9. Yarn 캐시 정리

- Yarn 캐시 크기를 확인하고 정리합니다
- 정리 후 결과를 보고합니다

### 10. .DS_Store 파일 정리

- .DS_Store 파일을 찾고 계산합니다
- 선택적 정리 옵션을 제공합니다

### 11. 안드로이드 스튜디오 파일 정리

- 안드로이드 스튜디오 설치를 확인합니다
- Gradle 캐시 및 SDK 임시 파일을 정리합니다
- AVD(Android Virtual Device) 파일을 보존합니다
- 빌드 디렉토리를 분석하고 수동 정리를 제안합니다
- 오래된 SDK 패키지를 식별합니다

### 12. 요약 보고서

- 모든 정리 작업 후 최종 디스크 사용량을 보고합니다
- 초기 상태와 비교합니다
- 추가 수동 정리 옵션을 제안합니다

## 로그 파일

모든 작업은 `~/logs` 디렉토리에 있는 타임스탬프가 있는 파일에 기록됩니다. 로그 파일에는 다음이 포함됩니다:

- 각 작업에 대한 타임스탬프
- 시스템 명령 출력
- 오류 메시지(있는 경우)
- 전후 지표

로그 파일 이름 형식: `cleanup_YYYYMMDD_HHMMSS.log`

## 사용자 정의 옵션

### 정리 대상 수정

필요하지 않은 섹션을 주석 처리하여 스크립트의 어떤 섹션이 실행되는지 사용자 정의할 수 있습니다:

```bash
# npm 정리를 비활성화하려면 섹션 4를 주석 처리합니다:
# log_message "SECTION 4: Checking npm cache"
# if command -v npm &>/dev/null; then
# ...
# fi
```

### 새 정리 작업 추가

새 정리 작업을 추가하려면 다음 템플릿을 따릅니다:

```bash
# 섹션 X: [새 작업 이름]
log_message "SECTION X: [새 작업 설명]"

# 여기에 명령어를 입력합니다
your_command_here 2>&1 | tee -a "$LOG_FILE" || handle_error "Failed to [description]"

log_message "----------------------------------------"
```

### 로그 위치 변경

스크립트 상단에 있는 `LOG_DIR` 변수를 수정합니다:

```bash
LOG_DIR="/your/preferred/log/directory"
```

## 잠재적 위험 및 고려 사항

### 위험: 우발적 삭제

스크립트는 가끔 필요할 수 있는 캐시 파일과 이전 버전을 제거합니다.

- **완화**: 스크립트는 중요한 시스템 파일을 제거하지 않고 안전한 정리 영역에 집중합니다.

### 위험: Docker 데이터 손실

Docker 리소스 정리는 유지하고 싶은 컨테이너를 제거할 수 있습니다.

- **완화**: Docker 정리 전에 대화형 확인이 필요합니다.

### 위험: 안드로이드 개발 환경

안드로이드 스튜디오 정리는 가상 기기 설정에 영향을 줄 수 있습니다.

- **완화**: 스크립트는 자동으로 AVD 파일을 정리하지 않고, 오래된 캐시와 임시 파일만 제거합니다.

### 위험: Sudo 액세스

스크립트는 시스템 로그에 액세스하기 위해 sudo가 필요합니다.

- **완화**: 로그 크기 확인만 sudo가 필요하며, 상승된 권한으로 시스템 파일을 수정하지 않습니다.

### 위험: 패키지 관리자 업데이트

Homebrew 업데이트는 가끔 문제를 일으킬 수 있습니다.

- **완화**: 스크립트는 오류를 처리하고 하나가 실패하면 다음 작업으로 계속 진행합니다.

## 문제 해결

### 권한 오류로 스크립트 실패

```
ERROR: Permission denied
```

**해결책**:

- 스크립트에 실행 권한이 있는지 확인합니다:
  ```
  chmod +x system_cleanup.sh
  ```
- 필요한 디렉토리에 대한 읽기/쓰기 권한을 확인합니다
- sudo 권한이 필요한 작업의 경우 적절한 권한을 부여합니다

### 디스크 공간 계산 오류

```
ERROR: Unable to calculate disk space
```

**해결책**:

- 디스크 공간 계산에 필요한 명령어가 시스템에 설치되어 있는지 확인합니다
- 디스크 마운트 상태를 확인합니다
- 필요한 경우 수동으로 디스크 공간을 확인합니다:
  ```
  df -h
  ```

### Homebrew 업데이트 실패

```
ERROR: Failed to update Homebrew
```

**해결책**: 자세한 오류를 보기 위해 수동으로 Homebrew 업데이트를 실행합니다:

```
brew update
```

### 시스템 로그에 액세스할 수 없음

```
Could not access system logs (sudo may be required)
```

**해결책**: 스크립트를 sudo로 실행하거나 sudo를 사용하고 싶지 않으면 이 섹션을 건너뜁니다.

### Docker 정리가 중단됨

**해결책**: Ctrl+C를 눌러 Docker 정리를 건너뛰고 스크립트의 나머지 부분을 계속 진행합니다.

### 안드로이드 스튜디오 정리 문제

```
ERROR: Failed to clean Gradle cache
```

**해결책**: 안드로이드 스튜디오가 실행 중인지 확인하고, 실행 중이면 종료한 후 다시 시도합니다.

## 보안 고려 사항

### 권한

- 스크립트는 시스템 로그 읽기에만 상승된 권한이 필요합니다
- sudo 권한으로 시스템 수정을 하지 않습니다
- 모든 정리 작업 전에 적절한 권한 체크를 수행합니다
- 권한 부족 시 작업을 안전하게 건너뛰도록 설계되어 있습니다

### 데이터 안전

- 알려진 캐시 디렉토리와 임시 파일만 정리합니다
- 사용자 데이터 디렉토리는 수정하지 않습니다
- 잠재적으로 파괴적인 작업(Docker 정리, 안드로이드 AVD 파일)에는 대화형 확인이 필요합니다
- 권한 체크 실패 시 데이터 손상을 방지하기 위한 안전장치가 구현되어 있습니다

### 로그 파일 보안

- 로그는 사용자의 홈 디렉토리에 저장됩니다
- 로그에는 민감한 정보가 포함되어 있지 않지만 시스템 경로가 포함될 수 있습니다

## 기여

### 문제 보고

문제가 발생하거나 개선 제안이 있는 경우 [이슈 트래커 URL]에 제출합니다.

### Pull 요청

기여는 환영합니다! 다음 단계를 따릅니다:

1. 저장소를 포크합니다
2. 기능 브랜치를 만듭니다
3. 변경 사항을 적용합니다
4. Pull 요청을 제출합니다

## 라이선스

이 스크립트는 MIT 라이선스로 배포됩니다. 자세한 내용은 LICENSE 파일을 참조합니다.

## 저자

[귀하의 이름/조직]

## 버전 기록

- v1.0 (2023-05-20): 초기 릴리스
- v1.1 (2023-05-25): Docker 정리 추가, 로깅 개선
- v1.2 (2023-06-10): node_modules 및 Yarn 캐시 정리 추가
- v1.3 (2023-07-15): .DS_Store 파일 정리 기능 추가
- v2.0 (2025-04-14): 안드로이드 스튜디오 정리 기능 추가, AVD 파일 보호 구현
- v2.1 (2025-04-30):
  - 권한 체크 시스템 개선
  - 시스템 라이브러리 캐시 정리 권한 체크 추가
  - 시스템 로그 정리 권한 체크 추가
  - 사용자 라이브러리 캐시 정리 권한 체크 추가
  - 임시 파일 정리 권한 체크 추가
  - 디스크 공간 계산 로직 개선
  - 디스크 공간 표시 단위 개선
  - 오류 처리 및 로깅 메시지 개선
- v2.2 (2025-05-09):
  - npm 캐시 정리 검증 기능 강화
  - 전역 패키지 관리 기능 추가
  - 시스템 작업 권한 처리 개선
  - 중요 시스템 로그 보존 기능 추가
  - 오류 보고 및 사용자 피드백 개선
  - 정리 작업 검증 단계 추가
