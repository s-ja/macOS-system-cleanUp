# System Cleanup Utility

## 개요

`system_cleanup.sh`는 macOS 시스템의 디스크 공간을 확보하고 시스템 상태를 유지하기 위해 설계된 자동화된 유지보수 스크립트입니다. 이 스크립트는 패키지 관리자, 캐시, 시스템 로그 등 시스템의 다양한 부분에 대한 일련의 정리 작업을 수행합니다.

## 주요 기능

- 디스크 사용량 분석 및 보고
- Homebrew 패키지 관리 및 정리
- npm 캐시 정리
- 시스템 로그 크기 확인
- Docker 리소스 정리(선택 사항)
- node_modules 디렉토리 분석 및 제안
- Yarn 캐시 정리
- .DS_Store 파일 정리
- 안드로이드 스튜디오 파일 정리
- 모든 작업에 대한 상세한 로깅
- 민감한 작업에 대한 대화형 옵션
- 종합적인 요약 보고서

## 설치

### 필수 조건

- macOS 운영 체제
- Bash 쉘
- Homebrew 패키지 관리자(관련 정리 기능용)
- npm(선택 사항, JavaScript 개발 캐시 정리용)
- Docker(선택 사항, 컨테이너 정리용)
- 안드로이드 스튜디오(선택 사항, 안드로이드 개발 파일 정리용)

### 설치 방법

1. 스크립트를 원하는 위치에 다운로드하세요:

   ```
   curl -o ~/src/system_cleanup.sh https://your-repository-url/system_cleanup.sh
   ```

   또는 텍스트 편집기를 사용하여 파일을 수동으로 생성할 수 있습니다.

2. 스크립트를 실행 가능하게 만드세요:

   ```
   chmod +x ~/src/system_cleanup.sh
   ```

3. (선택 사항) 시스템 전체에서 접근할 수 있도록 심볼릭 링크를 생성하세요:
   ```
   sudo ln -s ~/src/system_cleanup.sh /usr/local/bin/system_cleanup
   ```

## 사용 방법

### 기본 사용법

터미널에서 스크립트를 실행하세요:

```
./system_cleanup.sh
```

또는 심볼릭 링크를 생성한 경우:

```
system_cleanup
```

### 명령행 옵션

스크립트는 다음과 같은 옵션을 지원합니다:

```
  --help          도움말 메시지 표시
  --auto-clean    프롬프트 없이 모든 정리 작업 실행
  --dry-run       실제 정리 없이 정리될 내용만 표시
  --no-brew       Homebrew 정리 건너뛰기
  --no-npm        npm 캐시 정리 건너뛰기
  --no-docker     Docker 정리 건너뛰기
  --no-android    안드로이드 스튜디오 정리 건너뛰기
```

예제:

```
./system_cleanup.sh --auto-clean --no-docker
```

### 자동화된 실행

스크립트를 일정에 따라 자동으로 실행하려면 `crontab`을 사용할 수 있습니다:

1. 편집을 위해 crontab을 엽니다:

   ```
   crontab -e
   ```

2. 스크립트를 매주 실행하는 라인을 추가합니다(예: 매주 일요일 자정):

   ```
   0 0 * * 0 /path/to/system_cleanup.sh --auto-clean
   ```

3. 선택적으로 특정 정리 작업을 건너뛰는 옵션을 추가할 수 있습니다:
   ```
   0 0 * * 0 /path/to/system_cleanup.sh --auto-clean --no-android
   ```

## 스크립트 섹션 설명

### 1. 로깅 설정

- 로그 디렉토리(`~/logs`)가 없는 경우 생성
- 각 실행마다 타임스탬프가 있는 로그 파일 생성
- 오류 처리 및 메시지 로깅 기능 구현
- 개선된 오류 처리 및 로깅 메시지 시스템

### 2. 디스크 사용량 확인

- 스크립트 시작 시 현재 디스크 사용량 보고
- 정리 후 비교를 위한 기준 지표 제공
- 개선된 디스크 공간 계산 및 표시 로직
- 다양한 단위(GB, MB, KB, B) 지원

### 3. 권한 체크 시스템

- 시스템 라이브러리 캐시 정리 권한 체크
- 시스템 로그 정리 권한 체크
- 사용자 라이브러리 캐시 정리 권한 체크
- 임시 파일 정리 권한 체크
- 권한 부족 시 안전하게 작업 건너뛰기

### 4. Homebrew 정리

- Homebrew 패키지 목록 업데이트
- 오래된 패키지 식별
- 사용하지 않는 종속성 확인
- 이전 버전 및 캐시 파일 정리

### 5. npm 캐시 정리

- npm이 설치되어 있는지 확인
- 정리 전 캐시 크기 보고
- 캐시 정리 수행
- 정리 후 절약된 공간 보고

### 6. 시스템 로그 확인

- 시스템 로그 파일 크기 보고
- 전체 정보를 위해 sudo 액세스 필요

### 7. Docker 정리(선택 사항)

- Docker가 설치되어 있는지 확인
- Docker 디스크 사용량 보고
- 사용하지 않는 Docker 리소스 정리 옵션 제공
- 부동 이미지, 중지된 컨테이너, 사용하지 않는 네트워크 포함

### 8. node_modules 디렉토리 정리

- 큰 node_modules 디렉토리 찾기 및 보고
- 오래된 프로젝트 식별 및 수동 정리 제안

### 9. Yarn 캐시 정리

- Yarn 캐시 크기 확인 및 정리
- 정리 후 결과 보고

### 10. .DS_Store 파일 정리

- .DS_Store 파일 찾기 및 계산
- 선택적 정리 옵션 제공

### 11. 안드로이드 스튜디오 파일 정리

- 안드로이드 스튜디오 설치 확인
- Gradle 캐시 및 SDK 임시 파일 정리
- AVD(Android Virtual Device) 파일 보존
- 빌드 디렉토리 분석 및 수동 정리 제안
- 오래된 SDK 패키지 식별

### 12. 요약 보고서

- 모든 정리 작업 후 최종 디스크 사용량 보고
- 초기 상태와 비교
- 추가 수동 정리 옵션 제안

## 로그 파일

모든 작업은 `~/logs` 디렉토리에 있는 타임스탬프가 있는 파일에 기록됩니다. 로그 파일에는 다음이 포함됩니다:

- 각 작업에 대한 타임스탬프
- 시스템 명령 출력
- 오류 메시지(있는 경우)
- 전후 지표

로그 파일 이름 형식: `cleanup_YYYYMMDD_HHMMSS.log`

## 사용자 정의 옵션

### 정리 대상 수정

필요하지 않은 섹션을 주석 처리하여 스크립트의 어떤 섹션이 실행되는지 사용자 정의할 수 있습니다:

```bash
# npm 정리를 비활성화하려면 섹션 4를 주석 처리하세요:
# log_message "SECTION 4: Checking npm cache"
# if command -v npm &>/dev/null; then
# ...
# fi
```

### 새 정리 작업 추가

새 정리 작업을 추가하려면 다음 템플릿을 따르세요:

```bash
# 섹션 X: [새 작업 이름]
log_message "SECTION X: [새 작업 설명]"

# 여기에 명령어 입력
your_command_here 2>&1 | tee -a "$LOG_FILE" || handle_error "Failed to [description]"

log_message "----------------------------------------"
```

### 로그 위치 변경

스크립트 상단에 있는 `LOG_DIR` 변수를 수정하세요:

```bash
LOG_DIR="/your/preferred/log/directory"
```

## 잠재적 위험 및 고려 사항

### 위험: 우발적 삭제

스크립트는 가끔 필요할 수 있는 캐시 파일과 이전 버전을 제거합니다.

- **완화**: 스크립트는 중요한 시스템 파일을 제거하지 않고 안전한 정리 영역에 집중합니다.

### 위험: Docker 데이터 손실

Docker 리소스 정리는 유지하고 싶은 컨테이너를 제거할 수 있습니다.

- **완화**: Docker 정리 전에 대화형 확인이 필요합니다.

### 위험: 안드로이드 개발 환경

안드로이드 스튜디오 정리는 가상 기기 설정에 영향을 줄 수 있습니다.

- **완화**: 스크립트는 자동으로 AVD 파일을 정리하지 않고, 오래된 캐시와 임시 파일만 제거합니다.

### 위험: Sudo 액세스

스크립트는 시스템 로그에 액세스하기 위해 sudo가 필요합니다.

- **완화**: 로그 크기 확인만 sudo가 필요하며, 상승된 권한으로 시스템 파일을 수정하지 않습니다.

### 위험: 패키지 관리자 업데이트

Homebrew 업데이트는 가끔 문제를 일으킬 수 있습니다.

- **완화**: 스크립트는 오류를 처리하고 하나가 실패하면 다음 작업으로 계속 진행합니다.

## 문제 해결

### 권한 오류로 스크립트 실패

```
ERROR: Permission denied
```

**해결책**:

- 스크립트에 실행 권한이 있는지 확인하세요:
  ```
  chmod +x system_cleanup.sh
  ```
- 필요한 디렉토리에 대한 읽기/쓰기 권한을 확인하세요
- sudo 권한이 필요한 작업의 경우 적절한 권한을 부여하세요

### 디스크 공간 계산 오류

```
ERROR: Unable to calculate disk space
```

**해결책**:

- 디스크 공간 계산에 필요한 명령어가 시스템에 설치되어 있는지 확인하세요
- 디스크 마운트 상태를 확인하세요
- 필요한 경우 수동으로 디스크 공간을 확인하세요:
  ```
  df -h
  ```

### Homebrew 업데이트 실패

```
ERROR: Failed to update Homebrew
```

**해결책**: 자세한 오류를 보기 위해 수동으로 Homebrew 업데이트를 실행해 보세요:

```
brew update
```

### 시스템 로그에 액세스할 수 없음

```
Could not access system logs (sudo may be required)
```

**해결책**: 스크립트를 sudo로 실행하거나 sudo를 사용하고 싶지 않으면 이 섹션을 건너뛰세요.

### Docker 정리가 중단됨

**해결책**: Ctrl+C를 눌러 Docker 정리를 건너뛰고 스크립트의 나머지 부분을 계속 진행하세요.

### 안드로이드 스튜디오 정리 문제

```
ERROR: Failed to clean Gradle cache
```

**해결책**: 안드로이드 스튜디오가 실행 중인지 확인하고, 실행 중이면 종료한 후 다시 시도하세요.

## 보안 고려 사항

### 권한

- 스크립트는 시스템 로그 읽기에만 상승된 권한이 필요합니다
- sudo 권한으로 시스템 수정을 하지 않습니다
- 모든 정리 작업 전에 적절한 권한 체크 수행
- 권한 부족 시 작업을 안전하게 건너뛰도록 설계

### 데이터 안전

- 알려진 캐시 디렉토리와 임시 파일만 정리합니다
- 사용자 데이터 디렉토리는 수정하지 않습니다
- 잠재적으로 파괴적인 작업(Docker 정리, 안드로이드 AVD 파일)에는 대화형 확인이 필요합니다
- 권한 체크 실패 시 데이터 손상을 방지하기 위한 안전장치 구현

### 로그 파일 보안

- 로그는 사용자의 홈 디렉토리에 저장됩니다
- 로그에는 민감한 정보가 포함되어 있지 않지만 시스템 경로가 포함될 수 있습니다

## 기여

### 문제 보고

문제가 발생하거나 개선 제안이 있는 경우 [이슈 트래커 URL]에 제출해 주세요.

### Pull 요청

기여는 환영합니다! 다음 단계를 따라주세요:

1. 저장소를 포크하세요
2. 기능 브랜치를 만드세요
3. 변경 사항을 적용하세요
4. Pull 요청을 제출하세요

## 라이선스

이 스크립트는 MIT 라이선스로 배포됩니다. 자세한 내용은 LICENSE 파일을 참조하세요.

## 저자

[귀하의 이름/조직]

## 버전 기록

- v1.0 (2023-05-20): 초기 릴리스
- v1.1 (2023-05-25): Docker 정리 추가, 로깅 개선
- v1.2 (2023-06-10): node_modules 및 Yarn 캐시 정리 추가
- v1.3 (2023-07-15): .DS_Store 파일 정리 기능 추가
- v2.0 (2025-04-14): 안드로이드 스튜디오 정리 기능 추가, AVD 파일 보호 구현
- v2.1 (2025-04-30):
  - 권한 체크 시스템 개선
  - 시스템 라이브러리 캐시 정리 권한 체크 추가
  - 시스템 로그 정리 권한 체크 추가
  - 사용자 라이브러리 캐시 정리 권한 체크 추가
  - 임시 파일 정리 권한 체크 추가
  - 디스크 공간 계산 로직 개선
  - 디스크 공간 표시 단위 개선
  - 오류 처리 및 로깅 메시지 개선
